import codecs
import sys

import mmh3
import requests


def calculate_favicon_hash(url):
    try:
        response = requests.get(
            f"{url}/favicon.ico",
            stream=True,
            allow_redirects=True,
            verify=True,
            timeout=10,
        )
        response.raise_for_status()

        favicon_data = codecs.encode(response.content, "base64")
        return mmh3.hash(favicon_data)

    except requests.exceptions.RequestException as e:
        print(f"Error fetching favicon: {e}")
        return None


if len(sys.argv) > 1:
    url = sys.argv[1]
else:
    print("Error: Favicon URL required.")
    exit(1)

favicon_hash = calculate_favicon_hash(url)

if favicon_hash:
    print("Favicon hash:", favicon_hash)
else:
    print("Error generating hash.")
